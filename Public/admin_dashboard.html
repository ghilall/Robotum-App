<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yönetici Paneli</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.2/build/css/intlTelInput.min.css" />
  <link rel="stylesheet" href="admin/admin_dashboard.css" /> 
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Yönetici Paneli</h2>
    </div>
    
    <div class="admin-info">
      <p><strong>Ad Soyad:</strong> <span id="userName">Yükleniyor...</span></p>
      <p><strong>Email:</strong> <span id="userEmail">Yükleniyor...</span></p>
      <p><strong>Telefon:</strong> <span id="userPhone">Yükleniyor...</span></p>
      <p><strong>Son Giriş:</strong> <span id="lastLogin">Yükleniyor...</span></p>
    </div>

    <div class="sidebar-menu">
      <div class="menu-item active" onclick="showSection('dashboard', event)">
        <i>📊</i>
        <span>Dashboard</span>
      </div>
      <div class="menu-item" onclick="showSection('guardians', event)">
        <i>👥</i>
        <span>Veli Yönetimi</span>
      </div>
      <div class="menu-item" onclick="showSection('students', event)">
        <i>🎓</i>
        <span>Öğrenci Yönetimi</span>
      </div>
      <div class="menu-item" onclick="showSection('teachers', event)">
        <i>👨‍🏫</i>
        <span>Öğretmen Yönetimi</span>
      </div>
      <div class="menu-item" onclick="showSection('courses', event)">
        <i>📚</i>
        <span>Kurs Yönetimi</span>
      </div>
    </div>

    <div class="sidebar-footer">
      <button class="logout-btn" id="logoutBtn">
        <i>🚪</i>
        <span>Çıkış Yap</span>
      </button>
    </div>
  </div>

  <!-- Mobile Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <h1>Admin Paneli</h1>
      </div>
      <div class="header-right">
        <div class="admin-badge">Admin</div>
      </div>
    </header>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Dashboard Section -->
      <div id="dashboard-section" class="section-content">
        <!-- Welcome Card -->
        <div class="welcome-card">
          <h1>Hoşgeldiniz Yönetici</h1>
          <p>Buradan sistem kullanıcılarını ve kursları yönetebilirsiniz.</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card" onclick="showSection('students')" style="cursor:pointer;">
            <div class="stat-number" id="totalStudents">-</div>
            <div class="stat-label">Toplam Öğrenci</div>
          </div>
          <div class="stat-card" onclick="showSection('guardians')" style="cursor:pointer;">
            <div class="stat-number" id="totalGuardians">-</div>
            <div class="stat-label">Toplam Veli</div>
          </div>
          <div class="stat-card" onclick="showSection('teachers')" style="cursor:pointer;">
            <div class="stat-number" id="totalTeachers">-</div>
            <div class="stat-label">Toplam Öğretmen</div>
          </div>
          <div class="stat-card" onclick="showSection('courses')" style="cursor:pointer;">
            <div class="stat-number" id="totalCourses">-</div>
            <div class="stat-label">Aktif Kurslar</div>
          </div>
        </div>
      </div>

      <!-- Guardians Section -->
      <div id="guardians-section" class="management-section" style="display: none;">
        <div class="section-header">
          <h2>Veli Yönetimi</h2>
        </div>
        <div class="section-content">
          <div class="action-buttons">
            <button class="action-btn" id="openGuardianModalBtn" type="button">
              <i>➕</i>
              <span>Veli Ekle</span>
            </button>
            <button class="action-btn secondary" id="toggleGuardianActivePassiveBtn" type="button">
              <i>🔄</i>
              <span id="toggleGuardianActivePassiveBtnText">Pasif Velileri Göster</span>
            </button>
          </div>
          
          <!-- Search Bar -->
          <div class="search-container">
            <div class="search-input-group">
              <label for="guardianNameSearch">Veli Adı</label>
              <input type="text" id="guardianNameSearch" class="search-input-field" placeholder="Ad veya soyad ara...">
            </div>
            <div class="search-input-group">
              <label for="guardianPhoneSearch">Telefon</label>
              <input type="text" id="guardianPhoneSearch" class="search-input-field" placeholder="Telefon numarası ara...">
            </div>
            <div class="search-input-group">
              <label for="studentNameSearch">Öğrenci Adı</label>
              <input type="text" id="studentNameSearch" class="search-input-field" placeholder="Öğrenci adı ara...">
            </div>
            <div class="search-buttons">
              <button class="search-btn" onclick="searchGuardians()">
                🔍 Ara
              </button>
              <button class="clear-btn" onclick="clearGuardianSearch()">
                🗑️ Temizle
              </button>
            </div>
          </div>
          
          <div id="guardianSearchResults" style="display: none;"></div>
          
          <div class="guardian-list-container" id="guardianListContainer">
            <div class="loading">Veli listesi yükleniyor...</div>
          </div>
        </div>
      </div>

      <!-- Students Section -->
      <div id="students-section" class="management-section" style="display: none;">
        <div class="section-header">
          <h2>Öğrenci Yönetimi</h2>
        </div>
        <div class="section-content">
          <div class="action-buttons">
            <button class="action-btn" id="openStudentModalBtn" type="button">
              <i>➕</i>
              <span>Öğrenci Ekle</span>
            </button>
            <button class="action-btn secondary" id="toggleStudentActivePassiveBtn" type="button">
              <i>🔄</i>
              <span id="toggleStudentActivePassiveBtnText">Pasif Öğrencileri Göster</span>
            </button>
          </div>
          
          <!-- Search Bar -->
          <div class="search-container">
            <div class="search-input-group">
              <label for="categorySearch">Kategori</label>
              <select id="categorySearch" class="search-input-field">
                <option value="">Tüm kategoriler</option>
              </select>
            </div>
            <div class="search-input-group">
              <label for="courseSearch">Kurs</label>
              <select id="courseSearch" class="search-input-field">
                <option value="">Tüm kurslar</option>
              </select>
            </div>
            <div class="search-input-group">
              <label for="daySearch">Gün</label>
              <select id="daySearch" class="search-input-field">
                <option value="">Tüm günler</option>
                <option value="Pazartesi">Pazartesi</option>
                <option value="Salı">Salı</option>
                <option value="Çarşamba">Çarşamba</option>
                <option value="Perşembe">Perşembe</option>
                <option value="Cuma">Cuma</option>
                <option value="Cumartesi">Cumartesi</option>
                <option value="Pazar">Pazar</option>
              </select>
            </div>
            <div class="search-input-group">
              <label for="nameSearch">Öğrenci Adı</label>
              <input type="text" id="nameSearch" class="search-input-field" placeholder="Ad veya soyad ara...">
            </div>
            <div class="search-buttons">
              <button class="search-btn" onclick="searchStudents()">
                🔍 Ara
              </button>
              <button class="clear-btn" onclick="clearSearch()">
                🗑️ Temizle
              </button>
            </div>
          </div>
          
          <div id="searchResults" style="display: none;"></div>
          
          <div class="student-list-container" id="studentListContainer">
            <div class="loading">Öğrenci listesi yükleniyor...</div>
          </div>
        </div>
      </div>

      <!-- Teachers Section -->
      <div id="teachers-section" class="management-section" style="display: none;">
        <div class="section-header">
          <h2>Öğretmen Yönetimi</h2>
        </div>
        <div class="section-content">
          <div class="action-buttons">
            <button class="action-btn" id="openTeacherModalBtn" type="button">
              <i>➕</i>
              <span>Öğretmen Ekle</span>
            </button>
            <button class="action-btn secondary" id="toggleTeacherActivePassiveBtn" type="button">
              <i>🔄</i>
              <span id="toggleTeacherActivePassiveBtnText">Pasif Öğretmenleri Göster</span>
            </button>
            <a href="teacher_assignments.html" class="action-btn secondary">
              <i>📅</i>
              <span>Öğretmen Atamaları</span>
            </a>
          </div>
          
          <!-- Search Bar -->
          <div class="search-container">
            <div class="search-input-group">
              <label for="teacherNameSearch">Öğretmen Adı</label>
              <input type="text" id="teacherNameSearch" class="search-input-field" placeholder="Ad veya soyad ara...">
            </div>
            <div class="search-input-group">
              <label for="teacherCategorySearch">Kategori</label>
              <select id="teacherCategorySearch" class="search-input-field">
                <option value="">Tüm kategoriler</option>
              </select>
            </div>
            <div class="search-input-group">
              <label for="teacherExperienceSearch">Deneyim</label>
              <select id="teacherExperienceSearch" class="search-input-field">
                <option value="">Tüm deneyim seviyeleri</option>
                <option value="Öğretmen">Öğretmen</option>
                <option value="Yardımcı">Yardımcı</option>
                <option value="Stajyer">Stajyer</option>
              </select>
            </div>
            <div class="search-buttons">
              <button class="search-btn" onclick="searchTeachers()">
                🔍 Ara
              </button>
              <button class="clear-btn" onclick="clearTeacherSearch()">
                🗑️ Temizle
              </button>
            </div>
          </div>
          
          <div id="teacherSearchResults" style="display: none;"></div>
          
          <div class="teacher-list-container" id="teacherListContainer">
            <div class="loading">Öğretmen listesi yükleniyor...</div>
          </div>
        </div>
      </div>

      <!-- Courses Section -->
      <div id="courses-section" class="management-section" style="display: none;">
        <div class="section-header">
          <h2>Kurs Yönetimi</h2>
        </div>
        <div class="section-content">
          <div class="action-buttons">
            <button class="action-btn" id="openCourseModalBtn" type="button">
              <i>➕</i>
              <span>Kurs Ekle</span>
            </button>
            <button class="action-btn secondary" id="toggleCourseActivePassiveBtn" type="button">
              <i>🔄</i>
              <span id="toggleCourseActivePassiveBtnText">Pasif Kursları Göster</span>
            </button>
          </div>
          <div class="search-container">
            <div class="search-input-group">
              <label for="courseNameSearch">Kurs Adı</label>
              <input type="text" id="courseNameSearch" class="search-input-field" placeholder="Kurs adı ara...">
            </div>
            <div class="search-input-group">
              <label for="courseLevelSearch">Seviye</label>
              <select id="courseLevelSearch" class="search-input-field">
                <option value="">Tüm seviyeler</option>
                <option value="Okul Öncesi">Okul Öncesi</option>
                <option value="İlkokul">İlkokul</option>
                <option value="Ortaokul">Ortaokul</option>
                <option value="Lise">Lise</option>
                <option value="Yetişkin">Yetişkin</option>
              </select>
            </div>
            <div class="search-input-group">
              <label for="courseDifficultySearch">Zorluk</label>
              <select id="courseDifficultySearch" class="search-input-field">
                <option value="">Tüm zorluk seviyeleri</option>
                <option value="Başlangıç">Başlangıç</option>
                <option value="Orta">Orta</option>
                <option value="İleri">İleri</option>
              </select>
            </div>
            <div class="search-buttons">
              <button class="search-btn" id="searchCourseBtn">
                🔍 Ara
              </button>
              <button class="clear-btn" id="clearCourseSearchBtn">
                🗑️ Temizle
              </button>
            </div>
          </div>
          <div id="courseListContainer">
            <div class="loading">Kurs listesi yükleniyor...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Öğrenci Kayıt Modalı -->
  <div id="studentModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeStudentModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      <h1>Öğrenci Kayıt Formu</h1>
      <form id="studentRegistrationForm">
        <label for="firstName">Ad</label>
        <input type="text" id="firstName" name="firstName" required />
        <label for="lastName">Soyad</label>
        <input type="text" id="lastName" name="lastName" required />
        <label for="birthDate">Doğum Tarihi</label>
        <input type="date" id="birthDate" name="birthDate" required />
        <label for="categoryFilter">Kategori (opsiyonel)</label>
        <select id="categoryFilter">
          <option value="">Tümü</option>
        </select>
        <label for="levelFilter">Seviye (opsiyonel)</label>
        <select id="levelFilter">
          <option value="">Tümü</option>
        </select>
        <label for="courseId">Kurs</label>
        <select id="courseId" name="courseId" required>
          <option value="">Yükleniyor...</option>
        </select>
        <label for="studentProgramDay">Gün</label>
        <select id="studentProgramDay" name="programDay" required>
          <option value="">Gün seçiniz</option>
          <option value="Pazartesi">Pazartesi</option>
          <option value="Salı">Salı</option>
          <option value="Çarşamba">Çarşamba</option>
          <option value="Perşembe">Perşembe</option>
          <option value="Cuma">Cuma</option>
          <option value="Cumartesi">Cumartesi</option>
          <option value="Pazar">Pazar</option>
        </select>
        <label for="programId">Program Saati</label>
        <select id="programId" name="programId" required>
          <option value="">Saat seçiniz</option>
        </select>
        <label for="guardianSearch">Veli Ara</label>
        <input type="text" id="guardianSearch" placeholder="İsimle ara..." autocomplete="off" />
        <div id="guardianResults"></div>
        <input type="hidden" id="guardianId" name="guardianId" required />
        <button type="submit">Kaydı Tamamla</button>
      </form>
    </div>
  </div>

  <!-- Veli Kayıt Modalı -->
  <div id="guardianModal" class="modal" style="display:none;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeGuardianModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      <h1 style="text-align:center;">Veli Ekle</h1>
      <form id="registerGuardianForm">
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="guardianFirstName">Ad:</label>
            <input type="text" id="guardianFirstName" name="firstName" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="guardianLastName">Soy Ad:</label>
            <input type="text" id="guardianLastName" name="lastName" required />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="guardianPhone">Telefon Numarası:</label>
            <input type="tel" id="guardianPhone" name="phone" required placeholder="555 555 55 55" />
            <div id="guardianPhoneError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Geçersiz telefon numarası.</div>
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="guardianEmail">Email Adresi:</label>
            <input type="email" id="guardianEmail" name="email" required />
            <div id="guardianEmailError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Bu email adresi ile bir hesap bulunuyor.</div>
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="password-wrapper" style="flex:1; min-width:280px;">
            <label for="guardianPassword">Şifre:</label>
            <div class="password-input-container" style="display:flex; align-items:center; gap:8px; border:1.5px solid #ccc; border-radius:5px; overflow:hidden; height:48px;">
              <input type="password" id="guardianPassword" name="password" required style="flex:1; border:none; padding:12px; font-size:16px; outline:none; box-sizing:border-box; vertical-align:middle; margin-top:0; margin-bottom:0; line-height:24px; height:40px;" />
              <button type="button" class="togglePassword" style="padding:10px 14px; font-size:14px; cursor:pointer; background:none; border:1.5px solid #d33; border-radius:5px; color:#d33; transition:background-color 0.3s, color 0.3s; height:40px; display:flex; align-items:center;">Göster</button>
            </div>
          </div>
          <div class="password-wrapper" style="flex:1; min-width:280px;">
            <label for="guardianConfirmPassword">Şifre (Tekrar):</label>
            <div class="password-input-container" style="display:flex; align-items:center; gap:8px; border:1.5px solid #ccc; border-radius:5px; overflow:hidden; height:48px;">
              <input type="password" id="guardianConfirmPassword" name="confirmPassword" required style="flex:1; border:none; padding:12px; font-size:16px; outline:none; box-sizing:border-box; vertical-align:middle; margin-top:0; margin-bottom:0; line-height:24px; height:40px;" />
              <button type="button" class="togglePassword" style="padding:10px 14px; font-size:14px; cursor:pointer; background:none; border:1.5px solid #d33; border-radius:5px; color:#d33; transition:background-color 0.3s, color 0.3s; height:40px; display:flex; align-items:center;">Göster</button>
            </div>
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="guardianOccupation">Meslek:</label>
            <select id="guardianOccupation" name="occupation" required>
              <option value="">Meslek Seçiniz</option>
              <option value="1">Öğretmen</option>
              <option value="2">İşçi</option>
              <option value="3">Mühendis</option>
              <option value="4">Polis</option>
              <option value="5">Asker</option>
              <option value="6">Avukat</option>
              <option value="7">Savcı</option>
              <option value="8">Doktor</option>
              <option value="9">Ev Hanımı</option>
              <option value="10">Veteriner Hekim</option>
              <option value="11">Hemşire</option>
              <option value="12">Diş Hekimi</option>
              <option value="13">İşletme Sahibi</option>
              <option value="14">Diğer</option>
            </select>
          </div>
        </div>
        <button type="submit">Veliyi Kaydet</button>
        <div id="guardianPasswordError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Şifreler eşleşmiyor. Lütfen aynı şifreyi girin.</div>
        <div id="guardianRegisterError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Kayıt başarısız oldu.</div>
      </form>
    </div>
  </div>

  <!-- Öğretmen Kayıt Modalı -->
  <div id="teacherModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="registration-container" style="position:relative; margin:auto; max-width:800px; width:90vw; min-width:350px; background:white; padding:40px 30px; border-radius:12px; box-shadow:0 8px 32px rgba(0,0,0,0.18); overflow-y:auto; max-height:95vh;">
      <button id="closeTeacherModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:28px; cursor:pointer;">&times;</button>
      <h1 style="text-align:center; margin-bottom:24px;">Öğretmen Kayıt Formu</h1>
      <form id="registerTeacherForm">
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherFirstName">Ad:</label>
            <input type="text" id="teacherFirstName" name="firstName" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherLastName">Soyad:</label>
            <input type="text" id="teacherLastName" name="lastName" required />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherPhone">Telefon Numarası:</label>
            <input type="tel" id="teacherPhone" name="phone" required />
            <div id="teacherPhoneError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Geçersiz telefon numarası.</div>
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherEmail">Email Adresi:</label>
            <input type="email" id="teacherEmail" name="email" required />
            <div id="teacherEmailError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Bu email adresi ile bir hesap bulunuyor.</div>
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherPassword">Şifre:</label>
            <div class="password-input-container" style="display:flex; align-items:center; gap:8px; border:1.5px solid #ccc; border-radius:5px; overflow:hidden; height:48px;">
              <input type="password" id="teacherPassword" name="password" required style="flex:1; border:none; padding:12px; font-size:16px; outline:none; box-sizing:border-box; vertical-align:middle; margin-top:0; margin-bottom:0; line-height:24px; height:40px;" />
              <button type="button" class="togglePassword" style="padding:10px 14px; font-size:14px; cursor:pointer; background:none; border:1.5px solid #d33; border-radius:5px; color:#d33; transition:background-color 0.3s, color 0.3s; height:40px; display:flex; align-items:center;">Göster</button>
            </div>
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherConfirmPassword">Şifre (Tekrar):</label>
            <div class="password-input-container" style="display:flex; align-items:center; gap:8px; border:1.5px solid #ccc; border-radius:5px; overflow:hidden; height:48px;">
              <input type="password" id="teacherConfirmPassword" name="confirmPassword" required style="flex:1; border:none; padding:12px; font-size:16px; outline:none; box-sizing:border-box; vertical-align:middle; margin-top:0; margin-bottom:0; line-height:24px; height:40px;" />
              <button type="button" class="togglePassword" style="padding:10px 14px; font-size:14px; cursor:pointer; background:none; border:1.5px solid #d33; border-radius:5px; color:#d33; transition:background-color 0.3s, color 0.3s; height:40px; display:flex; align-items:center;">Göster</button>
            </div>
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherSalary">Maaş:</label>
            <input type="text" id="teacherSalary" name="salary" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherSSN">TC / SGK No:</label>
            <input type="text" id="teacherSSN" name="socialSecurityNumber" required />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherEmploymentType">Çalışma Türü:</label>
            <select id="teacherEmploymentType" name="employmentType" required>
              <option value="">Seçiniz</option>
              <option value="Tam Zamanlı">Tam Zamanlı</option>
              <option value="Yarı Zamanlı">Yarı Zamanlı</option>
            </select>
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherCategoryId">Kategori:</label>
            <select id="teacherCategoryId" name="categoryId" required>
              <option value="">Kategori Seçiniz</option>
            </select>
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherStartDate">Başlangıç Tarihi:</label>
            <input type="date" id="teacherStartDate" name="startDate" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherEndDate">Bitiş Tarihi (opsiyonel):</label>
            <input type="date" id="teacherEndDate" name="endDate" />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="teacherExperience">Deneyim:</label>
            <select id="teacherExperience" name="experience" required>
              <option value="">Öğretmen deneyimi seçiniz</option>
              <option value="Öğretmen">Baş Öğretmen</option>
              <option value="Yardımcı">Yardımcı Öğretmen</option>
              <option value="Stajyer">Stajyer</option>
            </select>
          </div>
        </div>
        <button type="submit">Kayıt Et</button>
        <div id="teacherPasswordError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Şifreler eşleşmiyor. Lütfen aynı şifreyi girin.</div>
        <div id="teacherRegisterError" class="error" style="display:none; color:red; font-size:small; margin-bottom:15px;">Kayıt başarısız oldu.</div>
      </form>
    </div>
  </div>

  <!-- Öğrenci Düzenle Modalı -->
  <div id="editStudentModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeEditStudentModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      <h1>Öğrenci Bilgilerini Düzenle</h1>
      <form id="editStudentForm">
        <label for="editFirstName">Ad</label>
        <input type="text" id="editFirstName" name="firstName" required />
        <label for="editLastName">Soyad</label>
        <input type="text" id="editLastName" name="lastName" required />
        <label for="editBirthDate">Doğum Tarihi</label>
        <input type="date" id="editBirthDate" name="birthDate" required />
        <!-- Add other editable attributes here as needed -->
        <button type="submit">Kaydet</button>
      </form>
    </div>
  </div>

  <!-- Kurs Değiştir Modalı -->
  <div id="changeCourseModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeChangeCourseModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      <div id="changeCourseStudentInfo" style="margin-bottom:16px; font-size:1.1em;"></div>
      <h1>Kurs ve Program Değiştir</h1>
      <form id="changeCourseForm">
        <label for="changeCategoryFilter">Kategori (opsiyonel)</label>
        <select id="changeCategoryFilter">
          <option value="">Tümü</option>
        </select>
        <label for="changeLevelFilter">Seviye (opsiyonel)</label>
        <select id="changeLevelFilter">
          <option value="">Tümü</option>
        </select>
        <label for="changeCourseId">Kurs</label>
        <select id="changeCourseId" name="courseId" required>
          <option value="">Yükleniyor...</option>
        </select>
        <label for="changeProgramDay">Gün</label>
        <select id="changeProgramDay" name="programDay" required>
          <option value="">Gün seçiniz</option>
          <option value="Pazartesi">Pazartesi</option>
          <option value="Salı">Salı</option>
          <option value="Çarşamba">Çarşamba</option>
          <option value="Perşembe">Perşembe</option>
          <option value="Cuma">Cuma</option>
          <option value="Cumartesi">Cumartesi</option>
          <option value="Pazar">Pazar</option>
        </select>
        <label for="changeProgramId">Program Saati</label>
        <select id="changeProgramId" name="programId" required>
          <option value="">Saat seçiniz</option>
        </select>
        <button type="submit">Kaydet</button>
      </form>
    </div>
  </div>

  <!-- Guardian Düzenle Modalı -->
  <div id="editGuardianModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeEditGuardianModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      <h1>Veli Bilgilerini Düzenle</h1>
      <form id="editGuardianForm">
        <label for="editGuardianFirstName">Ad</label>
        <input type="text" id="editGuardianFirstName" name="firstName" required />
        <label for="editGuardianLastName">Soyad</label>
        <input type="text" id="editGuardianLastName" name="lastName" required />
        <label for="editGuardianEmail">Email</label>
        <input type="email" id="editGuardianEmail" name="email" required />
        <label for="editGuardianPhone">Telefon</label>
        <input type="tel" id="editGuardianPhone" name="phone" required />
        <button type="submit">Kaydet</button>
      </form>
    </div>
  </div>

  <!-- Öğretmen Düzenle Modalı -->
  <div id="editTeacherModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="registration-container" style="position:relative; margin:auto; max-width:800px; width:90vw; min-width:350px; background:white; padding:40px 30px; border-radius:12px; box-shadow:0 8px 32px rgba(0,0,0,0.18); overflow-y:auto; max-height:95vh;">
      <button id="closeEditTeacherModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:28px; cursor:pointer;">&times;</button>
      <h1 style="text-align:center; margin-bottom:24px;">Öğretmen Bilgilerini Düzenle</h1>
      <form id="editTeacherForm">
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherFirstName">Ad:</label>
            <input type="text" id="editTeacherFirstName" name="firstName" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherLastName">Soyad:</label>
            <input type="text" id="editTeacherLastName" name="lastName" required />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherPhone">Telefon Numarası:</label>
            <input type="tel" id="editTeacherPhone" name="phone" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherEmail">Email Adresi:</label>
            <input type="email" id="editTeacherEmail" name="email" required />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherSalary">Maaş:</label>
            <input type="text" id="editTeacherSalary" name="salary" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherSSN">TC / SGK No:</label>
            <input type="text" id="editTeacherSSN" name="socialSecurityNumber" required />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherEmploymentType">Çalışma Türü:</label>
            <select id="editTeacherEmploymentType" name="employmentType" required>
              <option value="">Seçiniz</option>
              <option value="Tam Zamanlı">Tam Zamanlı</option>
              <option value="Yarı Zamanlı">Yarı Zamanlı</option>
            </select>
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherCategoryId">Kategori:</label>
            <select id="editTeacherCategoryId" name="categoryId" required>
              <option value="">Kategori Seçiniz</option>
            </select>
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherStartDate">Başlangıç Tarihi:</label>
            <input type="date" id="editTeacherStartDate" name="startDate" required />
          </div>
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherEndDate">Bitiş Tarihi (opsiyonel):</label>
            <input type="date" id="editTeacherEndDate" name="endDate" />
          </div>
        </div>
        <div class="row" style="display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap;">
          <div class="half" style="flex:1; min-width:280px;">
            <label for="editTeacherExperience">Deneyim:</label>
            <select id="editTeacherExperience" name="experience" required>
              <option value="">Öğretmen deneyimi seçiniz</option>
              <option value="Öğretmen">Baş Öğretmen</option>
              <option value="Yardımcı">Yardımcı Öğretmen</option>
              <option value="Stajyer">Stajyer</option>
            </select>
          </div>
        </div>
        <button type="submit">Kaydet</button>
      </form>
    </div>
  </div>

  <!-- Add Course Modal -->
  <div id="courseModal" class="modal" style="display:none;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeCourseModalBtn" onclick="closeCourseModal()" style="position:absolute; top:10px; right:10px; background:#dc2626; color:white; border:none; font-size:20px; cursor:pointer; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; z-index:1000;">&times;</button>
      <h1>Kurs Ekle</h1>
      <form id="addCourseForm">
        <label for="courseName">Kurs Adı</label>
        <input type="text" id="courseName" name="courseName" required />
        <label for="courseCategory">Kategori</label>
        <select id="courseCategory" name="courseCategory" required>
          <option value="">Kategori seçiniz</option>
          <!-- Options will be populated dynamically -->
        </select>
        <label for="courseLevel">Seviye</label>
        <select id="courseLevel" name="courseLevel" required>
          <option value="">Seviye seçiniz</option>
          <option value="Okul Öncesi">Okul Öncesi</option>
          <option value="İlkokul">İlkokul</option>
          <option value="Ortaokul">Ortaokul</option>
          <option value="Lise">Lise</option>
          <option value="Yetişkin">Yetişkin</option>
        </select>
        <label for="courseDifficulty">Zorluk</label>
        <select id="courseDifficulty" name="courseDifficulty" required>
          <option value="">Zorluk seçiniz</option>
          <option value="Başlangıç">Başlangıç</option>
          <option value="Orta">Orta</option>
          <option value="İleri">İleri</option>
        </select>
        <label for="courseStatus">Durum</label>
        <select id="courseStatus" name="courseStatus" required>
          <option value="Aktif">Aktif</option>
          <option value="Pasif">Pasif</option>
        </select>
        <label for="courseClassroom">Sınıf</label>
        <select id="courseClassroom" name="courseClassroom" required>
          <option value="">Sınıf seçiniz</option>
        </select>
        <div style="display:flex; gap:10px; margin-top:20px;">
          <button type="submit" style="flex:1;">Kaydı Tamamla</button>
          <button type="button" onclick="closeCourseModal()" style="flex:1; background:#6b7280; padding:14px; border:none; color:white; font-size:18px; font-weight:600; border-radius:5px; cursor:pointer;">İptal</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Course Modal -->
  <div id="editCourseModal" class="modal" style="display:none;">
    <div class="registration-container" style="position:relative; margin:auto;">
      <button id="closeEditCourseModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      <h1>Kurs Düzenle</h1>
      <form id="editCourseForm">
        <label for="editCourseName">Kurs Adı</label>
        <input type="text" id="editCourseName" name="editCourseName" required />
        <label for="editCourseCategory">Kategori</label>
        <select id="editCourseCategory" name="editCourseCategory" required>
          <option value="">Kategori seçiniz</option>
          <!-- Options will be populated dynamically -->
        </select>
        <label for="editCourseLevel">Seviye</label>
        <select id="editCourseLevel" name="editCourseLevel" required>
          <option value="">Seviye seçiniz</option>
          <option value="Okul Öncesi">Okul Öncesi</option>
          <option value="İlkokul">İlkokul</option>
          <option value="Ortaokul">Ortaokul</option>
          <option value="Lise">Lise</option>
          <option value="Yetişkin">Yetişkin</option>
        </select>
        <label for="editCourseDifficulty">Zorluk</label>
        <select id="editCourseDifficulty" name="editCourseDifficulty" required>
          <option value="">Zorluk seçiniz</option>
          <option value="Başlangıç">Başlangıç</option>
          <option value="Orta">Orta</option>
          <option value="İleri">İleri</option>
        </select>
        <label for="editCourseStatus">Durum</label>
        <select id="editCourseStatus" name="editCourseStatus" required>
          <option value="Aktif">Aktif</option>
          <option value="Pasif">Pasif</option>
        </select>
        <button type="submit">Güncelle</button>
      </form>
    </div>
  </div>

  <!-- Course Programs Popup Modal -->
  <div id="courseProgramsModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="modal-content" style="background:white; padding:20px; border-radius:8px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; position:relative;">
      <button id="closeCourseProgramsModalBtn" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer; color:#666;">&times;</button>
      <h2 id="courseProgramsTitle" style="margin-bottom:20px; color:#333;">Kurs Programları</h2>
      
      <div class="programs-filter" style="margin-bottom:20px;">
        <div style="display: flex; justify-content: space-between; align-items: flex-end; gap: 15px;">
          <div style="flex: 1;">
            <label for="programDayFilter" style="display:block; margin-bottom:5px; font-weight:bold;">Gün Filtresi:</label>
            <select id="programDayFilter" style="padding:8px; border:1px solid #ddd; border-radius:4px; width:200px;">
              <option value="">Tüm günler</option>
              <option value="Pazartesi">Pazartesi</option>
              <option value="Salı">Salı</option>
              <option value="Çarşamba">Çarşamba</option>
              <option value="Perşembe">Perşembe</option>
              <option value="Cuma">Cuma</option>
              <option value="Cumartesi">Cumartesi</option>
              <option value="Pazar">Pazar</option>
            </select>
          </div>
          <div style="flex-shrink: 0;">
            <button id="addProgramBtn" onclick="handleAddProgramClick()" style="padding:8px 16px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; z-index:1000;">
              ➕ Program Ekle
            </button>
          </div>
        </div>
      </div>
      
      <div id="programsList" style="margin-top:20px;">
        <div class="loading">Programlar yükleniyor...</div>
      </div>
      
      <div class="modal-footer" style="margin-top:20px; text-align:right;">
        <button id="closeCourseProgramsBtn" style="padding:10px 20px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">Kapat</button>
      </div>
    </div>
  </div>

  <!-- intl-tel-input CDN -->
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.2/build/js/intlTelInput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.2/build/js/utils.js"></script>

  <!-- Admin js dosyalarını çağır -->
  <script src="admin/admin_dashboard_main.js"></script>
  <script src="admin/admin_manage_courses.js"></script>
  <script src="admin/admin_manage_students.js"></script>
  <script src="admin/admin_manage_guardians.js"></script>
  <script src="admin/admin_manage_teachers.js"></script>

  <script>
    // --- DOM ELEMENTLERİNİ EN BAŞTA TANIMLA ---
    const openStudentModalBtn = document.getElementById('openStudentModalBtn');
    const studentModal = document.getElementById('studentModal');
    const closeStudentModalBtn = document.getElementById('closeStudentModalBtn');
    const form = document.getElementById('studentRegistrationForm');
    const openGuardianModalBtn = document.getElementById('openGuardianModalBtn');
    const guardianModal = document.getElementById('guardianModal');
    const closeGuardianModalBtn = document.getElementById('closeGuardianModalBtn');
    const openTeacherModalBtn = document.getElementById('openTeacherModalBtn');
    const teacherModal = document.getElementById('teacherModal');
    const closeTeacherModalBtn = document.getElementById('closeTeacherModalBtn');

    document.addEventListener('DOMContentLoaded', function() {
      loadUser();
      loadDashboardStats();
      showSection('dashboard');
      loadStudentList();
      if (typeof loadCategories === 'function') {
        loadCategories('teacherCategoryId');
      } else {
        fetch('/api/categories', { credentials: 'include' })
          .then(res => res.json())
          .then(data => {
            const categorySelect = document.getElementById('teacherCategoryId');
            categorySelect.innerHTML = '<option value="">Kategori Seçiniz</option>';
            data.categories.forEach(cat => {
              const option = document.createElement('option');
              option.value = cat.Category_ID;
              option.textContent = cat.Category_Name;
              categorySelect.appendChild(option);
            });
          });
      }
      loadTeacherCategories();
    });

    // Display student list grouped by course
    function displayStudentList(groupedStudents) {
      const container = document.getElementById('studentListContainer');
      
      if (!groupedStudents || Object.keys(groupedStudents).length === 0) {
        container.innerHTML = '<div class="no-students">Henüz öğrenci bulunmuyor.</div>';
        return;
      }

      let html = '';
      
      for (const courseName in groupedStudents) {
        const students = groupedStudents[courseName];
        html += `
          <div class="course-group">
            <div class="course-title">${courseName}</div>
        `;
        
        for (const studentId in students) {
          const student = students[studentId];
          let programText = '';
          
          if (student.program && student.program.length > 0) {
            programText = student.program
              .map(p => `${p.day}: ${p.start} - ${p.end} (${p.room})`)
              .join(', ');
          }
          
          html += `
            <div class="student-item">
              <div class="student-info">
                <div class="student-name">${student.firstName} ${student.lastName}</div>
                <div class="student-details">
                  Öğrenci ID: ${student.studentId}
                </div>
                ${programText ? `<div class="program-info">📅 ${programText}</div>` : ''}
              </div>
              <div class="student-actions">
                <button class="edit-btn" onclick="editStudent(${student.studentId})">
                  ✏️ Düzenle
                </button>
                <button class="change-course-btn" onclick="changeStudentCourse(${student.studentId})">🔄 Kurs Değiştir</button>
                <button class="delete-btn" onclick="deleteStudent(${student.studentId}, '${student.firstName} ${student.lastName}')">
                  ⏸️ Pasife Al
                </button>
              </div>
            </div>
          `;
        }
        html += '</div>';
      }
      container.innerHTML = html;
    }
    // Öğrenci düzenleme için global değişken
    let editingStudentId = null;

    // Mobile sidebar functions
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
    }

    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.remove('open');
      overlay.classList.remove('open');
    }

    // Logout functionality (keeping your existing logic)
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('user');
      window.location.href = '/';
    });

    // Initialize
    loadDashboardStats();

    // Add event listeners for search inputs when DOM is loaded
    setTimeout(() => {
      const searchInputs = ['categorySearch', 'courseSearch', 'daySearch', 'nameSearch'];
      searchInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              searchStudents();
            }
          });
        }
      });
    }, 100);

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      if (window.innerWidth <= 768) {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (!sidebar.contains(e.target) && !e.target.classList.contains('mobile-menu-toggle')) {
          closeSidebar();
        }
      }
    });

    // Student search logic moved to admin_manage_students.js

    // Passive user viewing functions
    function viewPassiveStudents() {
      window.open('/passive_students.html', '_blank', 'width=1200,height=800');
    }

    function viewPassiveGuardians() {
      window.open('/passive_guardians.html', '_blank', 'width=1200,height=800');
    }

    function viewPassiveTeachers() {
      window.open('/passive_teachers.html', '_blank', 'width=1200,height=800');
    }

    
    // Modal açma/kapama
    if (openStudentModalBtn && studentModal && closeStudentModalBtn) {
      openStudentModalBtn.addEventListener('click', () => {
        document.querySelector('#studentModal h1').textContent = 'Öğrenci Kayıt Formu';
        form.reset();
        form.guardianId.value = '';
        form.guardianSearch.value = '';
        studentModal.style.display = 'flex';
      });
      closeStudentModalBtn.addEventListener('click', () => {
        studentModal.style.display = 'none';
      });
      window.addEventListener('click', (e) => {
        if (e.target === studentModal) studentModal.style.display = 'none';
      });
    }
    // Veli Modal açma/kapama
    let guardianIti;
    if (openGuardianModalBtn && guardianModal && closeGuardianModalBtn) {
      openGuardianModalBtn.addEventListener('click', () => {
        guardianModal.style.display = 'flex';
        setTimeout(() => {
          const guardianPhoneInput = document.getElementById('guardianPhone');
          if (guardianPhoneInput) {
            if (guardianIti) guardianIti.destroy();
            guardianIti = window.intlTelInput(guardianPhoneInput, {
              initialCountry: 'tr',
              separateDialCode: true,
              nationalMode: true,
              autoPlaceholder: 'polite',
              formatOnDisplay: true,
              utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.2/build/js/utils.js'
            });
          }
        }, 0);
      });
      closeGuardianModalBtn.addEventListener('click', () => {
        guardianModal.style.display = 'none';
      });
      window.addEventListener('click', (e) => {
        if (e.target === guardianModal) guardianModal.style.display = 'none';
      });
    }
    // Veli kayıt formu scriptleri
    const guardianForm = document.getElementById('registerGuardianForm');
    const guardianPhoneError = document.getElementById('guardianPhoneError');
    guardianForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      guardianPhoneError.style.display = 'none';
      if (!guardianIti || !guardianIti.isValidNumber()) {
        guardianPhoneError.style.display = 'block';
        return;
      }
      // Diğer validasyonlar ve form submit işlemleri burada devam edecek
      // Telefon numarasını guardianIti.getNumber() ile alın
      const data = {
        firstName: guardianForm.guardianFirstName.value,
        lastName: guardianForm.guardianLastName.value,
        phone: guardianIti.getNumber(),
        email: guardianForm.guardianEmail.value,
        password: guardianForm.guardianPassword.value,
        confirmPassword: guardianForm.guardianConfirmPassword.value,
        occupation: guardianForm.guardianOccupation.value
      };
      try {
        const response = await fetch('/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        if (!response.ok) {
          if (result.error && result.error.toLowerCase().includes('email')) {
            guardianEmailError.style.display = 'block';
          } else {
            guardianRegisterError.textContent = result.error || 'Kayıt başarısız oldu.';
            guardianRegisterError.style.display = 'block';
          }
        } else {
          guardianModal.style.display = 'none';
          // window.location.href = '/register_success.html';
          // İsteğe bağlı: veli listesini burada güncelleyebilirsiniz
        }
      } catch (err) {
        guardianRegisterError.textContent = 'Bağlantı hatası. Lütfen daha sonra tekrar deneyin.';
        guardianRegisterError.style.display = 'block';
      }
    });

    // Öğretmen Modal açma/kapama ve JS
    let teacherIti;
    if (openTeacherModalBtn && teacherModal && closeTeacherModalBtn) {
      openTeacherModalBtn.addEventListener('click', () => {
        loadTeacherCategories();
        teacherModal.style.display = 'flex';
        setTimeout(() => {
          const teacherPhoneInput = document.getElementById('teacherPhone');
          if (teacherPhoneInput) {
            if (teacherIti) teacherIti.destroy();
            teacherIti = window.intlTelInput(teacherPhoneInput, {
              initialCountry: 'tr',
              separateDialCode: true,
              nationalMode: true,
              autoPlaceholder: 'polite',
              formatOnDisplay: true,
              utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.2/build/js/utils.js'
            });
          }
        }, 0);
      });
      closeTeacherModalBtn.addEventListener('click', () => {
        teacherModal.style.display = 'none';
      });
      window.addEventListener('click', (e) => {
        if (e.target === teacherModal) teacherModal.style.display = 'none';
      });
    }
    // Form submit ve validasyonlar
    const teacherForm = document.getElementById('registerTeacherForm');
    const teacherPasswordError = document.getElementById('teacherPasswordError');
    const teacherEmailError = document.getElementById('teacherEmailError');
    const teacherRegisterError = document.getElementById('teacherRegisterError');
    const teacherPhoneError = document.getElementById('teacherPhoneError');
    teacherForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      teacherPasswordError.style.display = 'none';
      teacherEmailError.style.display = 'none';
      teacherRegisterError.style.display = 'none';
      teacherPhoneError.style.display = 'none';
      if (!teacherIti.isValidNumber()) {
        teacherPhoneError.style.display = 'block';
        return;
      }
      const password = teacherForm.teacherPassword.value;
      const confirmPassword = teacherForm.teacherConfirmPassword.value;
      if (password !== confirmPassword) {
        teacherPasswordError.style.display = 'block';
        return;
      }
      const data = {
        firstName: teacherForm.teacherFirstName.value,
        lastName: teacherForm.teacherLastName.value,
        phone: teacherIti.getNumber(),
        email: teacherForm.teacherEmail.value,
        password: password,
        salary: teacherForm.teacherSalary.value,
        socialSecurityNumber: teacherForm.teacherSSN.value,
        employmentType: teacherForm.teacherEmploymentType.value,
        categoryId: teacherForm.teacherCategoryId.value,
        startDate: teacherForm.teacherStartDate.value,
        endDate: teacherForm.teacherEndDate.value,
        experience: teacherForm.teacherExperience.value
      };
      try {
        const response = await fetch('/register_teacher', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        if (!response.ok) {
          if (result.error && result.error.toLowerCase().includes('email')) {
            teacherEmailError.style.display = 'block';
          } else {
            teacherRegisterError.textContent = result.error || 'Kayıt başarısız oldu.';
            teacherRegisterError.style.display = 'block';
          }
        } else {
          teacherModal.style.display = 'none';
          // window.location.href = '/register_success.html';
          // İsteğe bağlı: öğretmen listesini burada güncelleyebilirsiniz
        }
      } catch (err) {
        teacherRegisterError.textContent = 'Bağlantı hatası. Lütfen daha sonra tekrar deneyin.';
        teacherRegisterError.style.display = 'block';
      }
    });

    loadStudentModalCategoriesAndLevels();

    async function loadTeacherCategories() {
      const categorySelect = document.getElementById('teacherCategoryId');
      categorySelect.innerHTML = '<option value="">Kategori Seçiniz</option>';
      try {
        const res = await fetch('/api/categories', { credentials: 'include' });
        const data = await res.json();
        if (data.categories && data.categories.length > 0) {
          data.categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.Category_ID;
            option.textContent = cat.Category_Name;
            categorySelect.appendChild(option);
          });
        }
      } catch (err) {
        categorySelect.innerHTML = '<option value="">Kategoriler yüklenemedi</option>';
      }
    }

    // Course Programs Popup Functionality
    const courseProgramsModal = document.getElementById('courseProgramsModal');
    const closeCourseProgramsModalBtn = document.getElementById('closeCourseProgramsModalBtn');
    const closeCourseProgramsBtn = document.getElementById('closeCourseProgramsBtn');
    const courseNameSearch = document.getElementById('courseNameSearch');
    const courseLevelSearch = document.getElementById('courseLevelSearch');
    const courseDifficultySearch = document.getElementById('courseDifficultySearch');
    const programDayFilter = document.getElementById('programDayFilter');
    const programsList = document.getElementById('programsList');
    const courseProgramsTitle = document.getElementById('courseProgramsTitle');

    // Store current course information for filtering
    let currentCourseInfo = null;
    window.currentCourseInfo = null; // Make it globally accessible

    // Close modal functions
    function closeCourseProgramsModal() {
      courseProgramsModal.style.display = 'none';
      // Reset current course info when closing
      currentCourseInfo = null;
    }

    if (closeCourseProgramsModalBtn) {
      closeCourseProgramsModalBtn.addEventListener('click', closeCourseProgramsModal);
    }

    if (closeCourseProgramsBtn) {
      closeCourseProgramsBtn.addEventListener('click', closeCourseProgramsModal);
    }

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === courseProgramsModal) {
        closeCourseProgramsModal();
      }
    });

    // Load course programs
    async function loadCoursePrograms(courseName, courseLevel, courseDifficulty) {
      programsList.innerHTML = '<div class="loading">Programlar yükleniyor...</div>';
      
      // Store current course info for filtering
      currentCourseInfo = { courseName, courseLevel, courseDifficulty };
      window.currentCourseInfo = { courseName, courseLevel, courseDifficulty }; // Also set global
      
      try {
        // First, get the specific course by exact name match
        const courseResponse = await fetch('/api/courses', { credentials: 'include' });
        const courseData = await courseResponse.json();
        
        // Find the exact course by name
        const exactCourse = courseData.courses.find(course => 
          course.Course_Name === courseName
        );
        
        if (!exactCourse) {
          programsList.innerHTML = '<div class="no-programs">Kurs bulunamadı.</div>';
          return;
        }

        // Get programs for this specific course only
        const programResponse = await fetch(`/api/programs/by-course/${exactCourse.Course_ID}`, { credentials: 'include' });
        const programData = await programResponse.json();
        
        let allPrograms = [];
        if (programData.programs && programData.programs.length > 0) {
          allPrograms = programData.programs.map(program => ({
            ...program,
            courseName: exactCourse.Course_Name,
            courseLevel: exactCourse.Level
          }));
        }

        if (allPrograms.length === 0) {
          programsList.innerHTML = '<div class="no-programs">Bu kurs için program bulunamadı.</div>';
          return;
        }

        // Filter by day if selected
        const selectedDay = programDayFilter.value;
        if (selectedDay) {
          allPrograms = allPrograms.filter(program => program.Day === selectedDay);
        }

        // Sort programs by day and time
        const dayOrder = {
          'Pazartesi': 1, 'Salı': 2, 'Çarşamba': 3, 'Perşembe': 4,
          'Cuma': 5, 'Cumartesi': 6, 'Pazar': 7
        };

        allPrograms.sort((a, b) => {
          const dayA = dayOrder[a.Day] || 99;
          const dayB = dayOrder[b.Day] || 99;
          if (dayA !== dayB) return dayA - dayB;
          return a.Start_Time.localeCompare(b.Start_Time);
        });

        // Group programs by day
        const programsByDay = {};
        allPrograms.forEach(program => {
          if (!programsByDay[program.Day]) {
            programsByDay[program.Day] = [];
          }
          programsByDay[program.Day].push(program);
        });

        // Display programs
        let html = '';
        Object.keys(programsByDay).sort((a, b) => dayOrder[a] - dayOrder[b]).forEach(day => {
          html += `<div class="day-section" style="margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; padding: 15px;">`;
          html += `<h3 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">${day}</h3>`;
          
          programsByDay[day].forEach(program => {
            const isFull = parseInt(program.Current_Count) >= parseInt(program.Capacity);
            const statusClass = isFull ? 'program-full' : 'program-available';
            const statusText = isFull ? 'DOLU' : 'Müsait';
            
            html += `
              <div class="program-item ${statusClass}" style="
                background: ${isFull ? '#ffe6e6' : '#f0f8ff'};
                border: 1px solid ${isFull ? '#ff9999' : '#b3d9ff'};
                border-radius: 6px;
                padding: 12px;
                margin-bottom: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              ">
                <div class="program-info">
                  <div style="font-weight: bold; color: #333;">${program.courseName}</div>
                  <div style="color: #666; font-size: 14px;">Seviye: ${program.courseLevel}</div>
                  <div style="color: #666; font-size: 14px;">Saat: ${program.Start_Time.slice(0, 5)} - ${program.End_Time.slice(0, 5)}</div>
                  <div style="color: #666; font-size: 14px;">Sınıf: ${program.Classroom_ID}</div>
                </div>
                <div class="program-status" style="text-align: right;">
                  <div style="font-weight: bold; color: ${isFull ? '#d32f2f' : '#2e7d32'};">${statusText}</div>
                  <div style="font-size: 14px; color: #666;">${program.Current_Count}/${program.Capacity}</div>
                </div>
              </div>
            `;
          });
          
          html += `</div>`;
        });

        programsList.innerHTML = html;

      } catch (error) {
        console.error('Error loading course programs:', error);
        programsList.innerHTML = '<div class="error">Programlar yüklenirken hata oluştu.</div>';
      }
    }

    // Filter programs when day filter changes
    if (programDayFilter) {
      programDayFilter.addEventListener('change', async () => {
        // Use stored current course info instead of search fields
        if (currentCourseInfo) {
          await loadCoursePrograms(currentCourseInfo.courseName, currentCourseInfo.courseLevel, currentCourseInfo.courseDifficulty);
        }
      });
    }

    // Function to view programs for a specific course
    window.viewCoursePrograms = function(courseName, courseLevel, courseDifficulty) {
      // Modal ve başlık elementlerini bul
      const courseProgramsModal = document.getElementById('courseProgramsModal');
      const courseProgramsTitle = document.getElementById('courseProgramsTitle');
      if (!courseProgramsModal || !courseProgramsTitle) {
        alert('Programlar modalı bulunamadı. Lütfen sayfayı yenileyin.');
        return;
      }
      courseProgramsTitle.textContent = `Programlar - ${courseName}`;
      courseProgramsModal.style.display = 'flex';
      if (typeof loadCoursePrograms === 'function') {
        loadCoursePrograms(courseName, courseLevel, courseDifficulty);
      } else if (window.loadCoursePrograms) {
        window.loadCoursePrograms(courseName, courseLevel, courseDifficulty);
      } else {
        alert('Programlar yüklenemedi.');
      }
    };

    // Handle add program button click
    window.handleAddProgramClick = function() {
      console.log('handleAddProgramClick called');
      console.log('currentCourseInfo:', currentCourseInfo);
      console.log('window.currentCourseInfo:', window.currentCourseInfo);
      
      if (currentCourseInfo) {
        console.log('Opening add program modal...');
        window.openAddProgramModal(currentCourseInfo.courseName, currentCourseInfo.courseLevel, currentCourseInfo.courseDifficulty);
      } else if (window.currentCourseInfo) {
        console.log('Opening add program modal with window.currentCourseInfo...');
        window.openAddProgramModal(window.currentCourseInfo.courseName, window.currentCourseInfo.courseLevel, window.currentCourseInfo.courseDifficulty);
      } else {
        alert('Lütfen önce bir kurs seçin.');
      }
    };

    // Program Creation Modal Functionality
    const addProgramModal = document.getElementById('addProgramModal');
    const closeAddProgramModalBtn = document.getElementById('closeAddProgramModalBtn');
    const cancelAddProgramBtn = document.getElementById('cancelAddProgramBtn');
    const addProgramForm = document.getElementById('addProgramForm');

    let currentCourseForProgram = null;

    // Close modal functions
    function closeAddProgramModal() {
      addProgramModal.style.display = 'none';
      addProgramForm.reset();
      currentCourseForProgram = null;
    }

    if (closeAddProgramModalBtn) {
      closeAddProgramModalBtn.addEventListener('click', closeAddProgramModal);
    }

    if (cancelAddProgramBtn) {
      cancelAddProgramBtn.addEventListener('click', closeAddProgramModal);
    }

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === addProgramModal) {
        closeAddProgramModal();
      }
    });

    // Load classrooms for the dropdown
    async function loadClassrooms() {
      try {
        const response = await fetch('/api/classrooms', { credentials: 'include' });
        const data = await response.json();
        
        const programClassroom = document.getElementById('programClassroom');
        if (programClassroom) {
          programClassroom.innerHTML = '<option value="">Sınıf seçiniz</option>';
          data.classrooms.forEach(classroom => {
            const option = document.createElement('option');
            option.value = classroom.Classroom_ID;
            option.textContent = classroom.Classroom_Name;
            programClassroom.appendChild(option);
          });
        } else {
          console.error('programClassroom element not found');
        }
      } catch (error) {
        console.error('Error loading classrooms:', error);
        const programClassroom = document.getElementById('programClassroom');
        if (programClassroom) {
          programClassroom.innerHTML = '<option value="">Sınıflar yüklenemedi</option>';
        }
      }
    }

    // Function to open add program modal
    window.openAddProgramModal = function(courseName, courseLevel, courseDifficulty) {
      console.log('openAddProgramModal called with:', { courseName, courseLevel, courseDifficulty });
      currentCourseForProgram = { courseName, courseLevel, courseDifficulty };
      const selectedCourseName = document.getElementById('selectedCourseName');
      const selectedCourseLevel = document.getElementById('selectedCourseLevel');
      const addProgramModal = document.getElementById('addProgramModal');
      if (!addProgramModal) {
        console.error('addProgramModal element not found');
        alert('Modal yüklenemedi. Lütfen sayfayı yenileyin.');
        return;
      }
      if (selectedCourseName) {
        selectedCourseName.textContent = courseName;
      } else {
        console.error('selectedCourseName element not found');
      }
      if (selectedCourseLevel) {
        selectedCourseLevel.textContent = courseLevel;
      } else {
        console.error('selectedCourseLevel element not found');
      }
      // REMOVE: loadClassrooms();
      addProgramModal.style.display = 'flex';
      console.log('Modal should now be visible');
    };

    // Handle form submission
    if (addProgramForm) {
      addProgramForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        if (!currentCourseForProgram) {
          alert('Kurs bilgisi bulunamadı.');
          return;
        }
        const formData = new FormData(addProgramForm);
        const programData = {
          day: formData.get('day'),
          startTime: formData.get('startTime'),
          endTime: formData.get('endTime'),
          capacity: parseInt(formData.get('capacity'))
        };
        try {
          // Get the course ID by name (from context, not from form)
          const courseResponse = await fetch('/api/courses', { credentials: 'include' });
          const courseData = await courseResponse.json();
          const exactCourse = courseData.courses.find(course => 
            course.Course_Name === currentCourseForProgram.courseName
          );
          if (!exactCourse) {
            alert('Kurs bulunamadı.');
            return;
          }
          programData.courseId = exactCourse.Course_ID;
          // Submit the program
          const response = await fetch('/api/programs', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(programData)
          });
          const result = await response.json();
          if (response.ok) {
            showProgramSuccessToast();
            closeAddProgramModal();
            if (currentCourseInfo) {
              await loadCoursePrograms(currentCourseInfo.courseName, currentCourseInfo.courseLevel, currentCourseInfo.courseDifficulty);
            }
          } else {
            alert(result.error || 'Program eklenemedi.');
          }
        } catch (error) {
          console.error('Error adding program:', error);
          alert('Program eklenirken hata oluştu.');
        }
      });
    }

    // Add Program button functionality - moved here after all functions are defined
    const addProgramBtn = document.getElementById('addProgramBtn');
    console.log('addProgramBtn found:', addProgramBtn); // Debug log
    if (addProgramBtn) {
      addProgramBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('Add Program button clicked via event listener!'); // Debug log
        window.handleAddProgramClick();
      });
      console.log('Event listener attached to addProgramBtn'); // Debug log
    } else {
      console.error('addProgramBtn not found!'); // Debug log
    }

    // Program Ekle modalını kapat
    function closeAddProgramModal() {
      const addProgramModal = document.getElementById('addProgramModal');
      if (addProgramModal) addProgramModal.style.display = 'none';
    }

    // Kapatma butonuna event listener ekle
    document.addEventListener('DOMContentLoaded', function() {
      const closeBtn = document.getElementById('closeAddProgramModalBtn');
      if (closeBtn) {
        closeBtn.addEventListener('click', closeAddProgramModal);
      }
      // İptal butonuna event listener ekle
      const cancelBtn = document.getElementById('cancelAddProgramBtn');
      if (cancelBtn) {
        cancelBtn.addEventListener('click', closeAddProgramModal);
      }
      // Modal arka planına tıklayınca kapansın
      const addProgramModal = document.getElementById('addProgramModal');
      if (addProgramModal) {
        addProgramModal.addEventListener('click', function(e) {
          if (e.target === addProgramModal) closeAddProgramModal();
        });
      }
    });

    // Kursu pasife alma işlemi (modal içi)
    async function toggleModalCourseStatus(courseId) {
      // Kursu bul
      const course = allCourses.find(c => c.id === courseId);
      if (!course) {
        alert('Kurs bulunamadı.');
        return;
      }
      // Eğer kurs aktifse ve pasife alınacaksa, onay iste
      if (course.status === 'Aktif') {
        const confirmed = confirm(`"${course.name}" kursunu pasife almak istediğinizden emin misiniz?`);
        if (!confirmed) return;
      }
      try {
        const response = await fetch(`/api/courses/${courseId}/toggle-status`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Kurs durumu değiştirilemedi');
        }
        const result = await response.json();
        alert(result.message);
        // Refresh the course list to show updated status
        await refreshCourseList();
      } catch (err) {
        alert('Hata: ' + err.message);
        console.error('Kurs durumu değiştirme hatası:', err);
      }
    }

    async function loadClassroomsForCourseModal() {
      try {
        const response = await fetch('/api/classrooms', { credentials: 'include' });
        const data = await response.json();
        const classroomSelect = document.getElementById('courseClassroom');
        if (classroomSelect) {
          classroomSelect.innerHTML = '<option value="">Sınıf seçiniz</option>';
          data.classrooms.forEach(classroom => {
            const option = document.createElement('option');
            option.value = classroom.Classroom_ID;
            option.textContent = classroom.Classroom_Name + ' (Kapasite: ' + classroom.Capacity + ')';
            classroomSelect.appendChild(option);
          });
        }
      } catch (err) {
        const classroomSelect = document.getElementById('courseClassroom');
        if (classroomSelect) {
          classroomSelect.innerHTML = '<option value="">Sınıflar yüklenemedi</option>';
        }
      }
    }
    // Open course modal and load classrooms
    const openCourseModalBtn = document.getElementById('openCourseModalBtn');
    if (openCourseModalBtn) {
      openCourseModalBtn.addEventListener('click', function() {
        loadClassroomsForCourseModal();
        document.getElementById('courseModal').style.display = 'block';
      });
    }

    // Add this function to show the toast
    function showProgramSuccessToast() {
      const toast = document.getElementById('programSuccessToast');
      if (!toast) return;
      toast.style.display = 'block';
      setTimeout(() => { toast.style.opacity = '1'; }, 10);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => { toast.style.display = 'none'; }, 400);
      }, 2500);
    }

  </script>

  <!-- Program Creation Modal -->
  <div id="addProgramModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
    <div class="modal-content" style="background:white; padding:30px; border-radius:8px; max-width:500px; width:90%; max-height:90vh; overflow-y:auto; position:relative;">
      <button id="closeAddProgramModalBtn" style="position:absolute; top:15px; right:15px; background:none; border:none; font-size:24px; cursor:pointer; color:#666;">&times;</button>
      <h2 id="addProgramTitle" style="margin-bottom:25px; color:#333; text-align:center;">Program Ekle</h2>
      
      <form id="addProgramForm">
        <div style="margin-bottom:20px; padding:15px; background:#f8f9fa; border-radius:6px; border-left:4px solid #007bff;">
          <strong>Kurs:</strong> <span id="selectedCourseName">-</span><br>
          <strong>Seviye:</strong> <span id="selectedCourseLevel">-</span>
        </div>
        <label for="programDay">Gün *</label>
        <select id="programDay" name="day" required style="width:100%; padding:10px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
          <option value="">Gün seçiniz</option>
          <option value="Pazartesi">Pazartesi</option>
          <option value="Salı">Salı</option>
          <option value="Çarşamba">Çarşamba</option>
          <option value="Perşembe">Perşembe</option>
          <option value="Cuma">Cuma</option>
          <option value="Cumartesi">Cumartesi</option>
          <option value="Pazar">Pazar</option>
        </select>
        <label for="programStartTime">Başlangıç Saati *</label>
        <input type="time" id="programStartTime" name="startTime" required style="width:100%; padding:10px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
        <label for="programEndTime">Bitiş Saati *</label>
        <input type="time" id="programEndTime" name="endTime" required style="width:100%; padding:10px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
        <label for="programCapacity">Kapasite *</label>
        <input type="number" id="programCapacity" name="capacity" min="1" max="50" required style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ddd; border-radius:4px;" placeholder="Örn: 15">
        <div style="display:flex; gap:10px; justify-content:flex-end;">
          <button type="button" id="cancelAddProgramBtn" style="padding:10px 20px; background:#6c757d; color:white; border:none; border-radius:4px; cursor:pointer;">İptal</button>
          <button type="submit" style="padding:10px 20px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer;">Program Ekle</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add this just before </body> -->
  <div id="programSuccessToast" style="display:none; position:fixed; bottom:40px; left:50%; transform:translateX(-50%); background:#28a745; color:white; padding:18px 32px; border-radius:8px; font-size:18px; font-weight:bold; box-shadow:0 4px 16px rgba(0,0,0,0.18); z-index:99999; transition:opacity 0.4s; opacity:0;">
    Program başarıyla kaydedildi!
  </div>

</body>
</html>